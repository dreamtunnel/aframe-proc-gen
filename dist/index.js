"use strict";(()=>{var U=Object.create;var q=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var J=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);var K=(t,o,n,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of Y(o))!V.call(t,s)&&s!==n&&q(t,s,{get:()=>o[s],enumerable:!(e=W(o,s))||e.enumerable});return t};var N=(t,o,n)=>(n=t!=null?U(B(t)):{},K(o||!t||!t.__esModule?q(n,"default",{value:t,enumerable:!0}):n,t));var G=J((k,Z)=>{(function(t,o){typeof k=="object"?Z.exports=o():typeof define=="function"&&define.amd?define(o):t.Alea=o()})(k,function(){"use strict";return t.importState=function(n){var e=new t;return e.importState(n),e},t;function t(){return function(n){var e=0,s=0,r=0,c=1;n.length==0&&(n=[+new Date]);var a=o();e=a(" "),s=a(" "),r=a(" ");for(var l=0;l<n.length;l++)e-=a(n[l]),e<0&&(e+=1),s-=a(n[l]),s<0&&(s+=1),r-=a(n[l]),r<0&&(r+=1);a=null;var i=function(){var m=2091639*e+c*23283064365386963e-26;return e=s,s=r,r=m-(c=m|0)};return i.next=i,i.uint32=function(){return i()*4294967296},i.fract53=function(){return i()+(i()*2097152|0)*11102230246251565e-32},i.version="Alea 0.9",i.args=n,i.exportState=function(){return[e,s,r,c]},i.importState=function(m){e=+m[0]||0,s=+m[1]||0,r=+m[2]||0,c=+m[3]||0},i}(Array.prototype.slice.call(arguments))}function o(){var n=4022871197,e=function(s){s=s.toString();for(var r=0;r<s.length;r++){n+=s.charCodeAt(r);var c=.02519603282416938*n;n=c>>>0,c-=n,c*=n,n=c>>>0,c-=n,n+=c*4294967296}return(n>>>0)*23283064365386963e-26};return e.version="Mash 0.9",e}})});var L=.5*(Math.sqrt(3)-1),S=(3-Math.sqrt(3))/6,$=1/3,tt=1/6,et=(Math.sqrt(5)-1)/4,nt=(5-Math.sqrt(5))/20,X=t=>Math.floor(t)|0,P=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function T(t=Math.random){let o=Q(t),n=new Float64Array(o).map(s=>P[s%12*2]),e=new Float64Array(o).map(s=>P[s%12*2+1]);return function(r,c){let a=0,l=0,i=0,m=(r+c)*L,u=X(r+m),d=X(c+m),y=(u+d)*S,h=u-y,A=d-y,g=r-h,b=c-A,E,w;g>b?(E=1,w=0):(E=0,w=1);let M=g-E+S,x=b-w+S,p=g-1+2*S,f=b-1+2*S,H=u&255,D=d&255,v=.5-g*g-b*b;if(v>=0){let j=H+o[D],z=n[j],R=e[j];v*=v,a=v*v*(z*g+R*b)}let C=.5-M*M-x*x;if(C>=0){let j=H+E+o[D+w],z=n[j],R=e[j];C*=C,l=C*C*(z*M+R*x)}let F=.5-p*p-f*f;if(F>=0){let j=H+1+o[D+1],z=n[j],R=e[j];F*=F,i=F*F*(z*p+R*f)}return 70*(a+l+i)}}function Q(t){let n=new Uint8Array(512);for(let e=0;e<512/2;e++)n[e]=e;for(let e=0;e<512/2-1;e++){let s=e+~~(t()*(256-e)),r=n[e];n[e]=n[s],n[s]=r}for(let e=256;e<512;e++)n[e]=n[e-256];return n}var I=N(G());AFRAME.registerComponent("terrain",{schema:{width:{type:"number",default:100},height:{type:"number",default:100},flatRadius:{type:"number",default:10},smoothness:{type:"number",default:1},minHeight:{type:"number",default:-10},maxHeight:{type:"number",default:10},avgHeight:{type:"number",default:0},distanceScale:{type:"number",default:1},colors:{type:"array",default:["#000000","#4e3f30","#686256","#7e837f","#a8a9ad"]},seed:{type:"number",default:0}},map:function(t,o,n,e,s){let r=(t-o)/(n-o);return(s-e)*r+e},noise:function(t,o){return this.noise2D(t,o)/2+.5},octave:function(t,o,n,e){let s=0,r=1/e,c=0,a=1;for(let l=0;l<n;l++)s+=this.noise(t*r,o*r)*a,c+=a,a/=2,r*=2;return s/c},generateMesh:function(){let{width:t,height:o,avgHeight:n,minHeight:e,maxHeight:s,flatRadius:r,smoothness:c,colors:a,distanceScale:l}=this.data,i=new THREE.PlaneGeometry(t,o,t-1,o-1);i.receiveShadow=!0,i.castShadow=!0;let m=i.attributes.position.array,u=new Float32Array(i.attributes.position.count*3),d=r*2;for(let h=0,A=0;h<m.length;h+=3,A+=1){let g=A%t/t,b=Math.floor(A/t)/o,E=g-.5,w=b-.5,M=Math.sqrt(E*E+w*w),x=M*t;if(x<=r)m[h+2]=0;else{let H=this.octave(g,b,16,c),D=x<=r+d?(x-r)/d:1,v=s-e;m[h+2]=Math.min(Math.max(this.map(H,0,1,n-v,n+v)*D*M**l,e),s)}let p=m[h+2],f;p<-.1?f=new THREE.Color(a[0]):p<2?f=new THREE.Color(a[1]):p<5?f=new THREE.Color(a[2]):p<20?f=new THREE.Color(a[3]):f=new THREE.Color(a[4]),f.toArray(u,h)}i.setAttribute("color",new THREE.BufferAttribute(u,3)),i.rotateX(-Math.PI/2),i.computeVertexNormals();let y=new THREE.MeshPhongMaterial({vertexColors:!0});return new THREE.Mesh(i,y)},addWater:function(){let t=document.createElement("a-plane");t.setAttribute("position","0 -0.1 0"),t.setAttribute("rotation","-90 0 0"),t.setAttribute("width",this.data.width),t.setAttribute("height",this.data.height),t.setAttribute("color","#44ccff"),t.setAttribute("opacity","0.8"),this.el.appendChild(t)},init:function(){let t=(0,I.default)(this.data.seed);this.noise2D=T(t);let o=this.generateMesh();this.addWater(),this.el.setObject3D("mesh",o),this.updateChildren()},updateChildren:function(){let t=this.el,o=this.data;t.setAttribute("terrain-parameters",{}),t.querySelectorAll("[landform], [decoration]").forEach(n=>{n.components.landform?.modify(),n.components.decoration?.decorate()})}});var O=N(G());AFRAME.registerComponent("landform",{schema:{radius:{type:"number",default:10},peak:{type:"number",default:5},smoothness:{type:"number",default:1},seed:{type:"number",default:0},centerX:{type:"number",default:0},centerZ:{type:"number",default:0},terrain:{type:"selector",default:"#terrain"}},noise:function(t,o){return this.noise2D(t,o)/2+.5},octave:function(t,o,n,e){let s=0,r=1/e,c=0,a=1;for(let l=0;l<n;l++)s+=this.noise(t*r,o*r)*a,c+=a,a/=2,r*=2;return s/c},modifyTerrain:function(){console.log("?");let t=this.el.parentEl,{radius:o,peak:n,smoothness:e,centerX:s,centerZ:r}=this.data,c=t.getObject3D("mesh").geometry,a=c.attributes.position.array,l=c.attributes.color.array,i=t.components.terrain.data.width,m=t.components.terrain.data.height,u=t.components.terrain.data.colors;for(let d=0,y=0;d<a.length;d+=3,y+=1){let h=y%i/i,A=Math.floor(y/i)/m,g=h-.5+s/i,b=A-.5+r/m,w=Math.sqrt(g*g+b*b)*i;if(w<=o){let M=this.octave(h,A,16,e),x=1-w/o;a[d+1]+=M*n*x;let p=a[d+1],f;p<-.1?f=new THREE.Color(u[0]):p<2?f=new THREE.Color(u[1]):p<5?f=new THREE.Color(u[2]):p<20?f=new THREE.Color(u[3]):f=new THREE.Color(u[4]),f.toArray(l,d)}}c.attributes.position.needsUpdate=!0,c.attributes.color.needsUpdate=!0,c.computeVertexNormals()},init:function(){this.noise2D=T((0,O.default)(this.data.seed))},modify:function(){this.modifyTerrain()}});AFRAME.registerComponent("decoration",{schema:{copies:{type:"number",default:1},minHeight:{type:"number",default:0},maxHeight:{type:"number",default:1/0},minDistance:{type:"number",default:0},maxDistance:{type:"number",default:1/0}},decorate:function(){let t=this.el,o=this.data,n=t.firstElementChild;for(let r=1;r<o.copies;r++){let c=n.cloneNode(!0);t.appendChild(c)}let e=this.el.parentEl.getObject3D("mesh"),s=e.geometry.attributes.position.array;t.object3D.children.forEach((r,c)=>{let a,l,i,m,u,d=0;do a=Math.floor(Math.random()*s.length/3)*3,i=s[a+1],l=a/3%(e.geometry.parameters.widthSegments+1)/e.geometry.parameters.widthSegments*e.geometry.parameters.width-e.geometry.parameters.width/2,m=Math.floor(a/3/(e.geometry.parameters.widthSegments+1))/e.geometry.parameters.heightSegments*e.geometry.parameters.height-e.geometry.parameters.height/2,u=Math.sqrt(l*l+m*m);while((i<o.minHeight||i>o.maxHeight||u<o.minDistance||u>o.maxDistance)&&d++<100);if(d<100){let y=new THREE.Box3().setFromObject(t.object3D),h=y.max.y-y.min.y;console.log(y,h),r.position.set(l,i+h/4,m)}})}});})();
