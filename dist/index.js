"use strict";(()=>{var B=Object.create;var P=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var _=(e,o)=>()=>(o||e((o={exports:{}}).exports,o),o.exports);var $=(e,o,t,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of K(o))!Q.call(e,s)&&s!==t&&P(e,s,{get:()=>o[s],enumerable:!(n=J(o,s))||n.enumerable});return e};var O=(e,o,t)=>(t=e!=null?B(L(e)):{},$(o||!e||!e.__esModule?P(t,"default",{value:e,enumerable:!0}):t,e));var q=_((N,Z)=>{(function(e,o){typeof N=="object"?Z.exports=o():typeof define=="function"&&define.amd?define(o):e.Alea=o()})(N,function(){"use strict";return e.importState=function(t){var n=new e;return n.importState(t),n},e;function e(){return function(t){var n=0,s=0,r=0,c=1;t.length==0&&(t=[+new Date]);var i=o();n=i(" "),s=i(" "),r=i(" ");for(var u=0;u<t.length;u++)n-=i(t[u]),n<0&&(n+=1),s-=i(t[u]),s<0&&(s+=1),r-=i(t[u]),r<0&&(r+=1);i=null;var a=function(){var l=2091639*n+c*23283064365386963e-26;return n=s,s=r,r=l-(c=l|0)};return a.next=a,a.uint32=function(){return a()*4294967296},a.fract53=function(){return a()+(a()*2097152|0)*11102230246251565e-32},a.version="Alea 0.9",a.args=t,a.exportState=function(){return[n,s,r,c]},a.importState=function(l){n=+l[0]||0,s=+l[1]||0,r=+l[2]||0,c=+l[3]||0},a}(Array.prototype.slice.call(arguments))}function o(){var t=4022871197,n=function(s){s=s.toString();for(var r=0;r<s.length;r++){t+=s.charCodeAt(r);var c=.02519603282416938*t;t=c>>>0,c-=t,c*=t,t=c>>>0,c-=t,t+=c*4294967296}return(t>>>0)*23283064365386963e-26};return n.version="Mash 0.9",n}})});var tt=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,at=1/3,ct=1/6,it=(Math.sqrt(5)-1)/4,lt=(5-Math.sqrt(5))/20,X=e=>Math.floor(e)|0,I=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function V(e=Math.random){let o=et(e),t=new Float64Array(o).map(s=>I[s%12*2]),n=new Float64Array(o).map(s=>I[s%12*2+1]);return function(r,c){let i=0,u=0,a=0,l=(r+c)*tt,w=X(r+l),y=X(c+l),g=(w+y)*k,f=w-g,p=y-g,m=r-f,d=c-p,h,x;m>d?(h=1,x=0):(h=0,x=1);let b=m-h+k,E=d-x+k,A=m-1+2*k,j=d-1+2*k,v=w&255,G=y&255,F=.5-m*m-d*d;if(F>=0){let M=v+o[G],z=t[M],R=n[M];F*=F,i=F*F*(z*m+R*d)}let H=.5-b*b-E*E;if(H>=0){let M=v+h+o[G+x],z=t[M],R=n[M];H*=H,u=H*H*(z*b+R*E)}let D=.5-A*A-j*j;if(D>=0){let M=v+1+o[G+1],z=t[M],R=n[M];D*=D,a=D*D*(z*A+R*j)}return 70*(i+u+a)}}function et(e){let t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){let s=n+~~(e()*(256-n)),r=t[n];t[n]=t[s],t[s]=r}for(let n=256;n<512;n++)t[n]=t[n-256];return t}var U=O(q());function nt(e){return e/2+.5}function ot(e){let o=V((0,U.default)(e));return(t,n)=>nt(o(t,n))}function st(e,o,t,n,s){let r=0,c=1/s,i=0,u=1;for(let a=0;a<n;a++)r+=e(o*c,t*c)*u,i+=u,u/=2,c*=2;return r/i}function C(e){let o=ot(e);return(t,n,s,r)=>st(o,t,n,s,r)}function W(e,o,t,n,s){let r=(e-o)/(t-o);return(s-n)*r+n}function S(e,o,t,n){let s;e<-.1?s=new THREE.Color(o[0]):e<2?s=new THREE.Color(o[1]):e<5?s=new THREE.Color(o[2]):e<20?s=new THREE.Color(o[3]):s=new THREE.Color(o[4]),s.toArray(t,n)}var T=(e,o,t,n)=>{for(let s=0,r=0;s<e.length;s+=3,r+=1){let c=r%o/o,i=Math.floor(r/o)/t;n(s,c,i)}};AFRAME.registerComponent("terrain",{schema:{width:{type:"number",default:200},height:{type:"number",default:200},flatRadius:{type:"number",default:10},smoothness:{type:"number",default:1},minHeight:{type:"number",default:-10},maxHeight:{type:"number",default:10},avgHeight:{type:"number",default:0},distanceScale:{type:"number",default:1},colors:{type:"array",default:["#000000","#4e3f30","#686256","#7e837f","#a8a9ad"]},seed:{type:"number",default:0}},generateMesh:function(){let{width:e,height:o,avgHeight:t,minHeight:n,maxHeight:s,flatRadius:r,smoothness:c,colors:i,distanceScale:u}=this.data,a=new THREE.PlaneGeometry(e,o,e-1,o-1);a.receiveShadow=!0,a.castShadow=!0;let l=a.attributes.position.array,w=new Float32Array(a.attributes.position.count*3),y=r*2;T(l,e,o,(f,p,m)=>{let d=p-.5,h=m-.5,x=Math.sqrt(d*d+h*h),b=x*e;if(b<=r)l[f+2]=0;else{let A=this.octave(p,m,16,c),j=b<=r+y?(b-r)/y:1,v=s-n;l[f+2]=Math.min(Math.max(W(A,0,1,t-v,t+v)*j*x**u,n),s)}let E=l[f+2];S(E,i,w,f)}),a.setAttribute("color",new THREE.BufferAttribute(w,3)),a.rotateX(-Math.PI/2),a.computeVertexNormals();let g=new THREE.MeshPhongMaterial({vertexColors:!0});return new THREE.Mesh(a,g)},addWater:function(){let e=new THREE.PlaneGeometry(this.data.width,this.data.height),o=new THREE.MeshPhongMaterial({color:"#44ccff",opacity:.8,transparent:!0}),t=new THREE.Mesh(e,o);t.rotation.x=-Math.PI/2,t.position.y=-.1,this.el.object3D.add(t)},init:function(){this.octave=C(this.data.seed);let e=this.generateMesh();this.addWater(),this.el.setObject3D("mesh",e),this.updateChildren()},updateChildren:function(){let e=this.el,o=this.data;e.setAttribute("terrain-parameters",{}),e.querySelectorAll("[terrain-feature], [terrain-decoration]").forEach(t=>{t.components["terrain-feature"]?.modify(),t.components["terrain-decoration"]?.decorate()})}});AFRAME.registerComponent("terrain-feature",{schema:{radius:{type:"number",default:10},peak:{type:"number",default:5},smoothness:{type:"number",default:1},seed:{type:"number",default:0},centerX:{type:"number",default:0},centerZ:{type:"number",default:0}},modifyTerrain:function(){let e=this.el.parentEl,{radius:o,peak:t,smoothness:n,centerX:s,centerZ:r}=this.data,c=e.getObject3D("mesh").geometry,i=c.attributes.position.array,u=c.attributes.color.array,{width:a,height:l,colors:w}=e.components.terrain.data;T(i,a,l,(y,g,f)=>{let p=g-.5+s/a,m=f-.5+r/l,h=Math.sqrt(p*p+m*m)*a;if(h<=o){let x=this.octave(g,f,16,n),b=1-h/o;i[y+1]+=x*t*b;let E=i[y+1];S(E,w,u,y)}}),c.attributes.position.needsUpdate=!0,c.attributes.color.needsUpdate=!0,c.computeVertexNormals()},init:function(){this.octave=C(this.data.seed)},modify:function(){this.modifyTerrain()}});var Y=O(q());AFRAME.registerComponent("terrain-decoration",{schema:{copies:{type:"number",default:1},minHeight:{type:"number",default:0},maxHeight:{type:"number",default:1/0},minDistance:{type:"number",default:0},maxDistance:{type:"number",default:1/0},seed:{type:"number",default:0}},init:function(){this.random=(0,Y.default)(this.data.seed)},decorate:function(){let e=this.el,o=this.data,t=e.firstElementChild;for(let f=1;f<o.copies;f++){let p=t.cloneNode(!0);e.appendChild(p)}let n=this.el.parentEl.getObject3D("mesh"),s=n.geometry.attributes.position.array,{width:r,height:c,widthSegments:i,heightSegments:u}=n.geometry.parameters,{minHeight:a,maxHeight:l,minDistance:w,maxDistance:y}=o,g=[];for(let f=0;f<s.length;f+=3){let p=s[f+1],m=f/3%(i+1)/i*r-r/2,d=Math.floor(f/3/(i+1))/u*c-c/2,h=Math.sqrt(m*m+d*d);p>=a&&p<=l&&h>=w&&h<=y&&g.push({x:m,y:p,z:d})}if(g.length===0){console.warn("No valid positions found for terrain decoration.");return}e.object3D.children.forEach((f,p)=>{let m=Math.floor(this.random()*g.length),{x:d,y:h,z:x}=g[m],b=new THREE.Box3().setFromObject(e.object3D),E=b.max.y-b.min.y;f.position.set(d,h+E/4,x)})}});})();
